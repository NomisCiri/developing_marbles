---
title: '...'
author: "Simon"
date: "31/03/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Within subject change in response to social information.

We have a within subject design. So the appropriate thing to do here is to look at within subject change between solo and social but also risk and uncertainty. When youÂ´re Uncertain what to do you should shift your behavior more when you observe social information. 
In the Uncertain condition there seems to be a linear development from shifting less towards more.
In Risky Choice, adolescents seem to be most stubborn.

```{r, echo=FALSE, fig.height=4,fig.width=11}
# here i filter the trails so i can compute a difference score for each subject. First the Difference between DFE &
# DFD and then between Social and Independent Here i build the DFs

UncertaintySolo<-MarbleData%>%arrange(valueGamble,probGamble,subject)%>%
  group_by(subject)%>%
  filter(DFE1DFD0==1,Social1Ind0==0)%>%
  select(ChooseRisk,DFE1DFD0,Social1Ind0,subject,Agegroup,age)%>%
  summarySEwithin(measurevar = "ChooseRisk",betweenvars = c("subject","Agegroup","age"),withinvars = "DFE1DFD0")


UncertaintySocial<-MarbleData%>%arrange(valueGamble,probGamble,subject)%>%group_by(subject)%>%
  group_by(subject)%>%
  filter(DFE1DFD0==1,Social1Ind0==1)%>%
  select(ChooseRisk,DFE1DFD0,Social1Ind0,Agegroup,age)%>%
  summarySEwithin(measurevar = "ChooseRisk",betweenvars = c("subject","Agegroup","age"),withinvars = "DFE1DFD0")



RiskSolo<-MarbleData%>%arrange(valueGamble,probGamble,subject)%>%group_by(subject)%>%filter(DFE1DFD0==0,Social1Ind0==0)%>%
  group_by(subject)%>%
  select(ChooseRisk,DFE1DFD0,Social1Ind0,Agegroup,age)%>%
  summarySEwithin(measurevar = "ChooseRisk",betweenvars = c("subject","Agegroup","age"),withinvars = "Social1Ind0")

RiskSocial<-MarbleData%>%arrange(valueGamble,probGamble,subject)%>%group_by(subject)%>%filter(DFE1DFD0==0,Social1Ind0==1)%>%
  group_by(subject)%>%
  select(ChooseRisk,DFE1DFD0,Social1Ind0,Agegroup,age)%>%
  summarySEwithin(measurevar = "ChooseRisk",betweenvars = c("subject","Agegroup","age"),withinvars = "Social1Ind0")


RiskSocial$Change<-RiskSocial$ChooseRisk - RiskSolo$ChooseRisk
UncertaintySocial$Change<-UncertaintySocial$ChooseRisk - UncertaintySolo$ChooseRisk



# Make Plots and the arrange them in a grid.
Uncertain<-ggplot(UncertaintySocial,aes(x=age,y=Change))+#+geom_boxplot()+
  stat_summary(fun.data = mean_cl_boot,geom="pointrange")+
  geom_jitter(aes(color=Agegroup),width = 0.1,alpha=0.2)+
  scale_color_viridis_d()+
  #scale_x_discrete(name="PubertyStage", breaks=c(0,1,2),labels=c("Pre-Adolescents","Adolescents","Young Adults"))+
  scale_y_continuous(name="Change in Risky Choice [%]")+
  coord_cartesian(ylim=c(-0.4,0.4))+
  geom_hline(yintercept=0,linetype="dotdash")+
  guides(color=F)+
  ggtitle("Within Subject Change Social - Solo \n Uncertainty Trails")



Risk<-ggplot(RiskSocial,aes(x=age,y=Change))+#+geom_boxplot()+
  stat_summary(fun.data = mean_cl_boot,geom="pointrange")+
  geom_jitter(aes(color=Agegroup),width = 0.1,alpha=0.2)+
  #scale_x_discrete(name="PubertyStage", breaks=c(0,1,2),labels=c("Pre-Adolescents","Adolescents","Young Adults"))+
  scale_color_viridis_d()+
  scale_y_continuous(name="Change in Risky Choice [%]")+
  geom_hline(yintercept=0,linetype="dotdash")+
  coord_cartesian(ylim=c(-0.4,0.4))+
  guides(color=F)+
  ggtitle("Within Subject Change Social - Solo \n Risk Trails")


plot_grid(Risk, Uncertain, labels = "AUTO")

ggsave("X_Figures/Change_Uncertain_Risky.pdf",width=11,height=4)

```

# estimation?

```{r}


## How Good were they at Estimating?

In the Decisions from Expierience trials we asked Pariticpants about what they thing the outcome Ditribution really was. So now see if there are age differnces in estimating
these distributions. For this i treat the real distributions as factors.

```{r fig.height=5, fig.width=10}


MarbleData%>%filter(DFE1DFD0=="1"&PercentBlueEstimate!="NULL")%>%ggplot()+
  stat_summary(aes(x=as.numeric(Agegroup),y=PercentBlueEstimate,color=Agegroup),geom="pointrange",fun.data="mean_cl_boot",position = position_dodge(0.9))+ geom_smooth(aes(x=Agegroup,y=PercentBlueEstimate,group=PercentBlueShownRel),method="lm")+
  stat_summary(aes(y=as.numeric(as.character(PercentBlueShownRel))*10,x=3),geom="pointrange",position = position_dodge(0.9),shape=3,color="red")+
  scale_shape_manual(name="Distribution as Seen by Participant")+
  scale_color_viridis_d(name="PubertyStage",breaks=breaks,labels=labels2)+
  scale_x_discrete(name="Agegroup",breaks=breaks,labels=labels2)+
  scale_y_continuous(name="Participants Estimate")+
  facet_grid(~PercentBlueShownRel)+
  #coord_cartesian(ylim=c(30,70))+
  ggtitle("Estimation Accuracy")+theme_cowplot()+theme(axis.text.x = element_text(angle = 45, hjust = 1))

ggsave(filename="X_Figures/Accuracy.pdf")


```





## Who is most Confident?

```{r}


MarbleData%>%filter(DFE1DFD0=="1"&PercentBlueEstimate!="NULL")%>%
  ggplot(aes(x=age,y=HowSure,alpha=Agegroup))+
  #stat_summary(geom="bar",fun.y="mean")+
  stat_summary(geom="pointrange",fun.y=mean,fun.ymin =function(x) mean(x)-1.96*(sd(x)/sqrt(length(x))),fun.ymax=function(x) mean(x)+1.96*(sd(x)/sqrt(length(x))),position = position_dodge(0.9),alpha=0.7)+
  #geom_jitter(aes(x=as.numeric(PubertyStage),y=HowSure))+
  scale_x_discrete(name="Age")+
  scale_y_continuous(name="Confidence Rating")+
  guides(alpha=F)+
  #coord_cartesian(ylim=c(55,65))+
  ggtitle("Confidence Rating")

ggsave(filename="X_Figures/Confidence.pdf")

```

##### Is this substantial? 

Probably not.
Adolescents report to be least confident with their estimation. 
But if we look at the whole spectrum all age groups actually do seem fairly similar to one another.

```{r,fig.height=10,fig.width=20}


MarbleData%>%filter(DFE1DFD0=="1"&PercentBlueEstimate!="NULL")%>%
  ggplot(aes(y=HowSure,x=age,group=age))+
  #geom_jitter(aes(color=PercentBlueShownRel),width = 0.1)+
  stat_summary(fun.data = mean_cl_boot,geom="pointrange",size=1,color="red")+
  #geom_flat_violin(position = position_nudge(x = .25, y = 0),adjust =2, trim = TRUE,alpha=0.1,fill="black")+
  # geom_pointrange(aes(x = as.numeric(PubertyStage)+0.2, y = HowSure),outlier.shape = NA, alpha = 0.3, width = .1, colour = "BLACK", nudge_x = 1, nudge_y = 2) +
  scale_color_viridis_d(name="Observed outcome Probability")+
  scale_x_discrete(name="PubertyStage")+
  #geom_hline(yintercept = 150,linetype="dotdash")+
  scale_y_continuous(name="Confidence Rating")+
  ggtitle("Mean Confidence per Subject by Condition")+facet_grid(~PercentBlueShownRel)
```